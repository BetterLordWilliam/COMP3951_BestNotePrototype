<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:views="clr-namespace:BestNote_3951.Views"
             x:Class="BestNote_3951.Views.BestFileTreeView"
             x:Name="this">
    
    <VerticalStackLayout>
        <HorizontalStackLayout Margin="{Binding Level, Converter={StaticResource LevelToMarginConverter}, ConverterParameter=20}" >
            <Image Source="{Binding ImageIcon}" HeightRequest="20" />
            <Label Text="{Binding ItemName}" VerticalTextAlignment="Center" />
            <toolkit:Expander IsVisible="{Binding SubFiles.Count, Converter={StaticResource BoolConverter}}" HeightRequest="20">
                <toolkit:Expander.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding BindingContext.ToggleExpandCommand, Source={RelativeSource AncestorType={x:Type views:FileStructureView}}}" CommandParameter="{Binding .}" />
                </toolkit:Expander.GestureRecognizers>
            </toolkit:Expander>
        </HorizontalStackLayout>
        <CollectionView ItemsSource="{Binding SubFiles}" IsVisible="{Binding IsExpanded}">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <views:BestFileTreeView BestFile="{Binding .}" />
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
        
        <!-- Context View To add File to this node -->
        <FlyoutBase.ContextFlyout>
            <MenuFlyout>
                <MenuFlyoutItem Text="Add Subfolder" Command="{Binding BindingContext.AddFolderCommand, Source={RelativeSource AncestorType={x:Type views:FileStructureView}}}" CommandParameter="{Binding .}" />
                <MenuFlyoutItem Text="Add Note" Command="{Binding BindingContext.AddFileCommand, Source={RelativeSource AncestorType={x:Type views:FileStructureView}}}" CommandParameter="{Binding .}" />
            </MenuFlyout>
        </FlyoutBase.ContextFlyout>
    </VerticalStackLayout>
</ContentView>
